{"version":3,"sources":["index.js","App.js"],"names":["ReactDOM","render","controller","AbortController","dbServer","dateOptions","year","month","day","hour","minute","second","tableIcons","Add","forwardRef","props","ref","Check","Clear","Delete","DetailPanel","Edit","Export","Filter","FirstPage","LastPage","NextPage","PreviousPage","ResetSearch","Search","SortArrow","ThirdStateCheck","ViewColumn","useState","exchangeRates","selectedExchangeRate","erState","setERState","tickers","tickerId","tickerName","tickerSymbol","tickerPrice","tState","setTState","portfoliocolumns","title","field","symbol","positionData","precision","portfolioId","portfolioUnrealisedPL","portfolioRealisedPL","pState","setPState","loadTickers","e","a","tickerlist","fetch","tickresponse","json","tickbody","status","Error","message","ticker","push","toString","priceresponse","pricebody","Items","cmcCacheData","quote","price","refreshPortfolio","unrealisedPL","response","body","newData","positions","position","positionPL","currencyId","active","priceAtTrade","positionQty","id","_id","tradetime","Date","DateTime","toLocaleTimeString","name","tradePrice","rate","pl","toFixed","realisedPL","initPage","useEffect","abort","searchObject","obj","match","results","i","length","parseInt","getPrice","target","value","tickerData","enterTrade","window","confirm","postData","document","getElementById","method","headers","JSON","stringify","post","updateCacheFile","textContent","resetPortfolio","setTimeout","getOptions","map","getExchangeRates","exchangeRate","rateName","className","icons","columns","data","editable","onRowDelete","oldData","Promise","resolve","then","currentPriceRes","USD","alert","onChange","type","Button","variant","color","onClick","find","exchangeRateData"],"mappings":"knCAIAA,IAASC,OAAO,mBCqBD,WAEb,IAAMC,EAAa,IAAIC,gBASjBC,EAAW,8EAEXC,EAAc,CAAEC,KAAM,UAAWC,MAAO,UAAWC,IAAK,UAAWC,KAAM,UAAWC,OAAQ,UAAWC,OAAQ,WAE/GC,EAAa,CACjBC,IAAKC,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAYD,EAAZ,CAAmBC,IAAKA,QACxDC,MAAOH,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAWD,EAAX,CAAkBC,IAAKA,QACzDE,MAAOJ,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAWD,EAAX,CAAkBC,IAAKA,QACzDG,OAAQL,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAmBD,EAAnB,CAA0BC,IAAKA,QAClEI,YAAaN,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAkBD,EAAlB,CAAyBC,IAAKA,QACtEK,KAAMP,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAUD,EAAV,CAAiBC,IAAKA,QACvDM,OAAQR,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAaD,EAAb,CAAoBC,IAAKA,QAC5DO,OAAQT,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAgBD,EAAhB,CAAuBC,IAAKA,QAC/DQ,UAAWV,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAeD,EAAf,CAAsBC,IAAKA,QACjES,SAAUX,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAcD,EAAd,CAAqBC,IAAKA,QAC/DU,SAAUZ,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAkBD,EAAlB,CAAyBC,IAAKA,QACnEW,aAAcb,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAiBD,EAAjB,CAAwBC,IAAKA,QACtEY,YAAad,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAWD,EAAX,CAAkBC,IAAKA,QAC/Da,OAAQf,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAYD,EAAZ,CAAmBC,IAAKA,QAC3Dc,UAAWhB,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAiBD,EAAjB,CAAwBC,IAAKA,QACnEe,gBAAiBjB,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAYD,EAAZ,CAAmBC,IAAKA,QACpEgB,WAAYlB,sBAAW,SAACC,EAAOC,GAAR,OAAgB,kBAAC,IAAD,iBAAgBD,EAAhB,CAAuBC,IAAKA,SAhCzC,EAqCEiB,mBAAS,CACrCC,cAAe,CAAE,CAAC,SAAY,MAAO,KAAQ,EAAG,OAAU,KAAO,CAAC,SAAY,MAAO,KAAQ,IAAM,OAAU,SAC7GC,qBAAsB,CAAE,CAAC,SAAY,MAAO,KAAQ,EAAG,OAAU,QAvCvC,mBAqCrBC,EArCqB,KAqCZC,EArCY,OA0CAJ,mBAAS,CACnCK,QAAS,CAAE,IACXC,SAAU,GACVC,WAAY,GACZC,aAAc,GACdC,YAAa,KA/Ca,mBA0CrBC,EA1CqB,KA0CbC,EA1Ca,OAkDAX,mBAAS,CACnCY,iBAAkB,CAAE,CAAEC,MAAO,aAAcC,MAAO,aAAc,CAAED,MAAO,OAAQC,MAAO,QAAS,CAAED,MAAO,SAAUC,MAAO,UAAW,CAAED,MAAO,WAAYC,MAAO,YAAa,CAAED,MAAO,mBAAmBV,EAAQD,qBAAqB,GAAGa,OAAO,IAAKD,MAAO,cAAe,CAAED,MAAO,SAAUC,MAAO,UAAW,CAAED,MAAO,oBAAoBV,EAAQD,qBAAqB,GAAGa,OAAO,IAAKD,MAAO,OAClYE,aAAc,CAAE,IAChBC,UAAW,EACXC,YAAa,EACbC,sBAAuB,EACvBC,oBAAqB,IAxDK,mBAkDrBC,EAlDqB,KAkDbC,EAlDa,KA8DtBC,EAAW,uCAAG,WAAMC,GAAN,6CAAAC,EAAA,6DACdpB,EADc,YACAK,EAAOL,SACrBqB,EAAa,GAFC,SAGSC,MAAMxD,EAAS,kCAHxB,cAGZyD,EAHY,gBAIKA,EAAaC,OAJlB,UAIZC,EAJY,OAKU,MAAxBF,EAAaG,OALC,uBAMVC,MAAMF,EAASG,SANL,QAQlB,IARkB,6BAQlB,EAAmBH,EAAnB,+CAASI,EAAoB,QAC3BR,EAAWS,KAAKD,GATA,iPAWlB7B,EAAQqB,EACJpB,EAZc,YAYCI,EAAOJ,UAC1BA,EAASwB,EAAS,GAAGxB,SAAS8B,WAC1B5B,EAdc,YAcKE,EAAOF,cAC9BA,EAAesB,EAAS,GAAGtB,aACvBD,EAhBc,YAgBGG,EAAOH,YAC5BA,EAAauB,EAAS,GAAGvB,WAErBE,EAnBc,YAmBIC,EAAOD,YAAY2B,YAnBvB,UAoBUT,MAAMxD,EAAS,yCAAyCmC,GApBlE,eAoBZ+B,EApBY,iBAqBMA,EAAcR,OArBpB,WAqBZS,EArBY,OAsBW,MAAzBD,EAAcN,OAtBA,uBAuBVC,MAAMM,EAAUL,SAvBN,QAyBhBxB,EAAc6B,EAAUC,MAAM,GAAGC,aAAaC,MAAhC,IAAgDC,MAAMN,WACpEzB,EAAU,EAAD,GAAMD,EAAN,CAAcL,UAASI,cAAaH,WAAUE,eAAcD,gBA1BrD,6EAAH,sDAiCXoC,EAAgB,uCAAG,WAAMnB,GAAN,+CAAAC,EAAA,6DACnBT,EADmB,YACAK,EAAOL,cAE1BG,EAHmB,YAGSE,EAAOF,sBAAsBiB,YACzDhB,EAJmB,YAIOC,EAAOD,oBAAoBgB,YACzDpB,EAAe,GACX4B,EAAe,EANI,SAOAjB,MAAMxD,EAAS,kDAAkDkD,EAAOH,aAPxE,cAOjB2B,EAPiB,iBAQJA,EAAShB,OARL,WAQjBiB,EARiB,OASC,MAApBD,EAASd,OATU,uBAUfC,MAAMc,EAAKb,SAVI,QAYjBc,EAAU,GAZO,+BAaCD,EAAKP,MAAM,GAAGS,UAbf,0EAaXC,EAbW,QAcfxC,OAde,EAcHyC,EAAa,EAdV,UAeSvB,MAAMxD,EAAS,yCAAyC8E,EAASE,YAf1E,eAebd,EAfa,iBAgBKA,EAAcR,OAhBnB,WAgBbS,EAhBa,OAiBU,MAAzBD,EAAcN,OAjBC,uBAkBXC,MAAMM,EAAUL,SAlBL,QAoBjBxB,EAAY6B,EAAUC,MAAM,GAAGC,aAAaC,MAAhC,IAAgDC,MAAMN,WAE/Da,EAASG,SAEVR,IAA6BnC,EAAYwC,EAASI,cAAcJ,EAASK,YACzEJ,GAAczC,EAAYwC,EAASI,cAAcJ,EAASK,aAG5DP,EAAQZ,KAAK,CACXoB,GAAIN,EAASO,IACbtC,YAAa4B,EAAKP,MAAM,GAAGrB,YAC3BuC,UAAW,IAAIC,KAAKT,EAASU,UAAUC,mBAAmB,QAAUxF,GACpE+E,WAAYF,EAASE,WACrBU,KAAMZ,EAASY,KACf9C,OAAQkC,EAASlC,OACjBkC,SAAUA,EAASK,YACnBQ,WAAab,EAASI,aAAalD,EAAQD,qBAAqB,GAAG6D,KACnEX,OAAQH,EAASG,OAAOhB,WACxB4B,IAAId,EAAW/C,EAAQD,qBAAqB,GAAG6D,MAAME,QAAQ5C,EAAOJ,aAtCrD,+QA2CrBD,EAAe+B,EACf5B,EAAwByB,EACxBxB,EAAsB0B,EAAKP,MAAM,GAAG2B,WACpC5C,EAAU,EAAD,GAAMD,EAAN,CAAcL,eAAcG,wBAAuBC,yBA9CvC,6EAAH,sDAkDhB+C,EAAQ,uCAAG,sBAAA1C,EAAA,sDACfF,IACAoB,IAFe,2CAAH,qDAKdyB,qBAAU,WAER,OADAD,IACO,WAAQlG,EAAWoG,WAAa,IAGzC,IAAMC,EAAe,SAASC,EAAKC,EAAO1D,GAExC,IADA,IAAI2D,EAAU,GACNC,EAAI,EAAGA,EAAEH,EAAII,OAAQD,IACxBH,EAAIG,GAAG5D,IAAQ8D,SAASJ,IACzBC,EAAQtC,KAAKoC,EAAIG,IAGrB,OAAOD,GAMHI,EAAQ,uCAAG,WAAMrD,GAAN,2BAAAC,EAAA,6DACXnB,EADW,YACII,EAAOJ,UAC1BA,EAAWkB,EAAEsD,OAAOC,MAChBC,EAAaV,EAAa5D,EAAOL,QAAQC,EAAS,YAClDE,EAJW,YAIQE,EAAOF,cAC9BA,EAAewE,EAAW,GAAGxE,aACzBD,EANW,YAMMG,EAAOH,YAC5BA,EAAayE,EAAW,GAAGzE,WACvBE,EARW,YAQOC,EAAOD,YAAY2B,YAR1B,UASQT,MAAMxD,EAAS,yCAAyCmC,GAThE,eASTuC,EATS,iBAUIA,EAAShB,OAVb,WAUTiB,EAVS,OAWS,MAApBD,EAASd,OAXE,uBAYPC,MAAMc,EAAKb,SAZJ,QAcbxB,EAAeqC,EAAKP,MAAM,GAAGC,aAAaC,MAA3B,IAA2CC,MAC1D/B,EAAU,EAAD,GAAMD,EAAN,CAAcJ,WAAUG,cAAYF,aAAYC,kBAf5C,4CAAH,sDAsBRyE,EAAU,uCAAG,WAAMzD,GAAN,mBAAAC,EAAA,0DACbyD,OAAOC,QAAS,iBADH,wBAEXC,EAAW,IACNjD,KAAK,CAAC,YAAed,EAAOH,cACrCkE,EAASjD,KAAK,CAAC,UAAa,IAAIuB,OAChC0B,EAASjD,KAAK,CAAC,YAAckD,SAASC,eAAe,eAAeP,QACpEK,EAASjD,KAAK,CAAC,SAAWzB,EAAOJ,WACjC8E,EAASjD,KAAK,CAAC,WAAazB,EAAOH,aACnC6E,EAASjD,KAAK,CAAC,aAAezB,EAAOF,eACrC4E,EAASjD,KAAK,CAAC,YAAczB,EAAOD,cATrB,UAWQkB,MAAMxD,EAAS,uBAAwB,CAC5DoH,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElB1C,KAAM2C,KAAKC,UAAU,CAAEC,KAAMP,MAhBhB,eAWTvC,EAXS,iBAkBIA,EAlBJ,WAkBTC,EAlBS,OAmBS,MAApBD,EAASd,OAnBE,uBAoBPC,MAAMc,EAAKb,SApBJ,QAsBbU,IAtBa,4CAAH,sDA8BViD,EAAe,uCAAG,WAAMpE,GAAN,iBAAAC,EAAA,sEAECE,MAAMxD,EAAS,yBAAyBqD,EAAEsD,OAAOe,aAFlD,cAEhBhD,EAFgB,gBAGHA,EAAShB,OAHN,UAGhBiB,EAHgB,OAIE,MAApBD,EAASd,OAJS,uBAKdC,MAAMc,EAAKb,SALG,QAOpBV,IAEAZ,EAAU,EAAD,GAAKD,EAAL,CAAaL,QADR,MAEdsC,IAVoB,4CAAH,sDAiBfmD,EAAc,uCAAG,WAAMtE,GAAN,mBAAAC,EAAA,0DACjByD,OAAOC,QAAS,iBADC,wBAEfC,EAAW,IACNjD,KAAK,CAAC,YAAed,EAAOH,cAHlB,SAIIS,MAAMxD,EAAS,sBAAuB,CAC3DoH,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElB1C,KAAM2C,KAAKC,UAAU,CAAEC,KAAMP,MATZ,cAIbvC,EAJa,gBAWAA,EAXA,UAWbC,EAXa,OAYK,MAApBD,EAASd,OAZM,uBAaXC,MAAMc,EAAKb,SAbA,QAejB8D,YAAW,WACTpD,MACC,KAjBc,4CAAH,sDAsBdqD,EAAatF,EAAOL,QAAQ4F,KAChC,SAAC/D,GAAD,OAAY,4BAAQ6C,MAAO7C,EAAO5B,UAAW4B,EAAO3B,eAGhD2F,EAAmB/F,EAAQF,cAAcgG,KAC7C,SAACE,GAAD,OAAkB,4BAAQpB,MAAOoB,EAAaC,UAAWD,EAAaC,aAWxE,OACE,6BAEA,yBAAKC,UAAU,YACf,yBAAKA,UAAU,WAAU,2CACzB,yBAAKA,UAAU,UAAS,qDAA2BlG,EAAQD,qBAAqB,GAAGa,OAAO,IAAIM,EAAOF,sBAAsBhB,EAAQD,qBAAqB,GAAG6D,MAAME,QAAQ5C,EAAOJ,aAChL,yBAAKoF,UAAU,YAAW,mDAAyBlG,EAAQD,qBAAqB,GAAGa,OAAO,IAAIM,EAAOD,oBAAoBjB,EAAQD,qBAAqB,GAAG6D,MAAME,QAAQ5C,EAAOJ,cAI9K,kBAAC,IAAD,CACAJ,MAAM,iBACNyF,MAAO3H,EACP4H,QAASlF,EAAOT,iBAChB4F,KAAMnF,EAAOL,aACbyF,SAAU,CACRC,YAAa,SAAAC,GAAO,OACpB,IAAIC,SAAQ,SAAAC,GACY,SAAnBF,EAAQvD,OACT2C,YAAW,WACTpE,MAAMxD,EAAS,yCAAyCwI,EAAQxD,WAAY,IAC3E2D,MAAK,SAASjE,GACb,OAAOA,EAAShB,UAEjBiF,MAAK,SAASC,GACb,IAAI3B,EAAW,GACfA,EAASjD,KAAK,CAAC,YAAewE,EAAQzF,cACtCkE,EAASjD,KAAK,CAAC,MAAS,eACxBiD,EAASjD,KAAK,CAAC,WAAcwE,EAAQpD,KACrC6B,EAASjD,KAAK,CAAC,YAAe4E,EAAgBxE,MAAM,GAAGC,aAAaC,MAAMuE,IAAItE,MAAMiE,EAAQ7C,YAAY6C,EAAQ1D,WAChHtB,MAAMxD,EAAS,oBAAqB,CAClCoH,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,+BAAgC,IAChC,mCAAoC,OACpC,+BAAgC,+BAElC1C,KAAM2C,KAAKC,UAAU,CAAEC,KAAMP,MAC5B0B,MAAK,SAASjE,GACfF,IACAkE,YAGH,MAEHI,MAAM,sCACNJ,YAON,+BACA,+BACA,4BAAI,4BAAI,6CACR,4BAAI,+CAAwB,4BAAI,4BAAQK,SAAUrC,GAAWmB,KAC7D,4BAAI,iDAA0B,wBAAIzC,GAAG,eAAepD,EAAQD,qBAAqB,GAAGa,OAAO,GAAIL,EAAOD,YAAYN,EAAQD,qBAAqB,GAAG6D,OAClJ,4BAAI,iDAA0B,4BAAI,2BAAOR,GAAG,cAAc4D,KAAK,WAC/D,4BAAI,6BAAS,4BAAI,kBAACC,EAAA,EAAD,CAAQC,QAAQ,YAAYC,MAAM,UAAUC,QAAStC,GAArD,WACjB,4BAAI,4BAAI,gDACR,4BAAI,yDAAkC,4BAAI,kBAACmC,EAAA,EAAD,CAAQC,QAAQ,YAAYC,MAAM,UAAUC,QAAS3B,GAArD,wBAC1C,4BAAI,qDAA8B,4BAAI,kBAACwB,EAAA,EAAD,CAAQC,QAAQ,YAAYC,MAAM,UAAUC,QAAS3B,GAArD,4BACtC,4BAAI,+CAAwB,4BAAI,kBAACwB,EAAA,EAAD,CAAQC,QAAQ,YAAYC,MAAM,UAAUC,QAASzB,GAArD,oBAChC,4BAAI,qDAA2B3F,EAAQD,qBAAqB,GAAG6D,KAA3D,KAAsE,4BAAI,4BAAQmD,SAzE7D,SAAC1F,GAC1B,IAAItB,EAAoB,YAAOC,EAAQD,sBACnCiG,EAAehG,EAAQF,cAAcuH,MAAK,SAAAC,GAAgB,OAAIA,EAAiBrB,UAAY5E,EAAEsD,OAAOC,UACxG7E,EAAuB,IACFiC,KAAKgE,GAC1B/F,EAAW,EAAD,GAAMD,EAAN,CAAeD,4BAoE4FgG,UDzWzG,MAASb,SAASC,eAAe,W","file":"static/js/main.3c020b26.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","import React, { forwardRef, useState, useEffect }  from 'react'\nimport MaterialTable from 'material-table'\nimport AddBox from '@material-ui/icons/AddBox'\nimport ArrowUpward from '@material-ui/icons/ArrowUpward'\nimport Check from '@material-ui/icons/Check'\nimport ChevronLeft from '@material-ui/icons/ChevronLeft'\nimport ChevronRight from '@material-ui/icons/ChevronRight'\nimport Clear from '@material-ui/icons/Clear'\nimport DeleteOutline from '@material-ui/icons/DeleteOutline'\nimport Edit from '@material-ui/icons/Edit'\nimport FilterList from '@material-ui/icons/FilterList'\nimport FirstPage from '@material-ui/icons/FirstPage'\nimport LastPage from '@material-ui/icons/LastPage'\nimport Remove from '@material-ui/icons/Remove'\nimport SaveAlt from '@material-ui/icons/SaveAlt'\nimport Search from '@material-ui/icons/Search'\nimport ViewColumn from '@material-ui/icons/ViewColumn'\nimport Button from '@material-ui/core/Button'\n\nimport './App.css'\n\n/**\n* This is main export for the app.  Using a functional component and useEffect to access hooks.\n*/\n\nexport default function App() {\n\n  const controller = new AbortController()\n\n  // leave dbServer blank to default to send API calls to same endpoint as site\n  //const dbServer = \"\"\n  // Set dbServer to specific port on localhost\n  //const dbServer = \"http://localhost:3010\"\n  // Set dbServer to AWS docker image\n  //const dbServer = \"http://localhost:49160\"\n  // Set dbServer to location of deployed Node application\n  const dbServer = \"https://3299ece3ccc74205b96d7e7881b7bb1e.vfs.cloud9.eu-west-1.amazonaws.com\"\n\n  const dateOptions = { year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' }\n\n  const tableIcons = {\n    Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\n    Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\n    SortArrow: forwardRef((props, ref) => <ArrowUpward {...props} ref={ref} />),\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />)\n  }\n\n  const currency = 'USD'\n\n  const [erState, setERState] = useState({\n    exchangeRates: [ {'rateName': 'USD', 'rate': 1, 'symbol': '$'} , {'rateName' :'GBP', 'rate': 0.89, 'symbol': 'Â£' } ],\n    selectedExchangeRate: [ {'rateName': 'USD', 'rate': 1, 'symbol': '$'} ]\n  })\n\n  const [tState, setTState] = useState({\n    tickers: [ { } ],\n    tickerId: '',\n    tickerName: '',\n    tickerSymbol: '',\n    tickerPrice: '',\n  })\n\n  const [pState, setPState] = useState({\n    portfoliocolumns: [ { title: 'Trade time', field: 'tradetime' },{ title: 'Name', field: 'name' },{ title: 'Symbol', field: 'symbol' },{ title: 'Position', field: 'position' },{ title: 'Price at trade ('+erState.selectedExchangeRate[0].symbol+')', field: 'tradePrice' },{ title: 'Active', field: 'active' },{ title: 'Unrealised P&L  ('+erState.selectedExchangeRate[0].symbol+')', field: 'pl' } ],\n    positionData: [ { } ],\n    precision: 2,\n    portfolioId: 0,\n    portfolioUnrealisedPL: 0,\n    portfolioRealisedPL: 0,\n  })\n\n  /**\n  * Async function to retrieve ticker list and populate to state, and get the price for the first currency to display to the user.\n  */\n  const loadTickers = async e => {\n    let tickers = [...tState.tickers]\n    let tickerlist = []\n    const tickresponse = await fetch(dbServer+'/api/getTickers?table=cmcCache')\n    const tickbody = await tickresponse.json()\n    if (tickresponse.status !== 200) {\n      throw Error(tickbody.message)\n    }\n    for (let ticker of tickbody) {\n      tickerlist.push(ticker)\n    }\n    tickers=tickerlist\n    let tickerId = [...tState.tickerId]\n    tickerId=tickbody[0].tickerId.toString()\n    let tickerSymbol = [...tState.tickerSymbol]\n    tickerSymbol = tickbody[0].tickerSymbol\n    let tickerName = [...tState.tickerName]\n    tickerName = tickbody[0].tickerName\n\n    let tickerPrice = [...tState.tickerPrice.toString()]\n    const priceresponse = await fetch(dbServer+'/api/getPrice?table=cmcCache&tickerId='+tickerId)\n    const pricebody = await priceresponse.json()\n    if (priceresponse.status !== 200) {\n      throw Error(pricebody.message)\n    } else {\n      tickerPrice = pricebody.Items[0].cmcCacheData.quote[currency].price.toString()\n      setTState({ ...tState, tickers, tickerPrice, tickerId, tickerSymbol, tickerName })\n    }\n  }\n\n  /**\n  * Async function to retrieve portfolio list and populate to state, and calculate P&L on the fly for live positions.\n  */\n  const refreshPortfolio = async e => {\n    let positionData = [...pState.positionData]\n    // convert stored integers to strings to remain iterable\n    let portfolioUnrealisedPL = [...pState.portfolioUnrealisedPL.toString()]\n    let portfolioRealisedPL = [...pState.portfolioRealisedPL.toString()]\n    positionData = []\n    let unrealisedPL = 0\n    const response = await fetch(dbServer+'/api/getPortfolio?table=portfolios&portfolioId='+pState.portfolioId)\n    const body = await response.json()\n    if (response.status !== 200) {\n      throw Error(body.message)\n    } else {\n      let newData = []\n      for ( let position of body.Items[0].positions) {\n        let tickerPrice,positionPL = 0\n        const priceresponse = await fetch(dbServer+'/api/getPrice?table=cmcCache&tickerId='+position.currencyId)\n        const pricebody = await priceresponse.json()\n        if (priceresponse.status !== 200) {\n          throw Error(pricebody.message)\n        } else {\n          tickerPrice=pricebody.Items[0].cmcCacheData.quote[currency].price.toString()\n          // Only aggregate P&L for active positions\n          if(position.active) {\n            // Calculate P&L - current price - price at trade * position qty\n            unrealisedPL = unrealisedPL+(tickerPrice-position.priceAtTrade)*position.positionQty\n            positionPL = (tickerPrice-position.priceAtTrade)*position.positionQty\n          }\n          // Push each position up to the newData array\n          newData.push({\n            id: position._id,\n            portfolioId: body.Items[0].portfolioId,\n            tradetime: new Date(position.DateTime).toLocaleTimeString(\"en-GB\" , dateOptions ),\n            currencyId: position.currencyId,\n            name: position.name,\n            symbol: position.symbol,\n            position: position.positionQty,\n            tradePrice: (position.priceAtTrade*erState.selectedExchangeRate[0].rate),\n            active: position.active.toString(),\n            pl:(positionPL*erState.selectedExchangeRate[0].rate).toFixed(pState.precision)\n          })\n        }\n      }\n      // Set newData into positionData state for setting\n      positionData = newData\n      portfolioUnrealisedPL = unrealisedPL\n      portfolioRealisedPL = body.Items[0].realisedPL\n      setPState({ ...pState, positionData, portfolioUnrealisedPL, portfolioRealisedPL})\n    }\n  }\n\n  const initPage = async () => {\n    loadTickers()\n    refreshPortfolio()\n  }\n\n  useEffect(() => {\n    initPage()\n    return () => { controller.abort() } }, []\n  )\n\n  const searchObject = function(obj, match, field) {\n    let results = []\n    for(let i = 0; i<obj.length; i++) {\n      if(obj[i][field]==parseInt(match)) {\n        results.push(obj[i])\n      }\n    }\n    return results\n  }\n\n  /**\n  * Async function to retrieve price data for a ticker defined by the CMC ID.\n  */\n  const getPrice = async e => {\n    let tickerId = [...tState.tickerId]\n    tickerId = e.target.value\n    let tickerData = searchObject(tState.tickers,tickerId,\"tickerId\")\n    let tickerSymbol = [...tState.tickerSymbol]\n    tickerSymbol = tickerData[0].tickerSymbol\n    let tickerName = [...tState.tickerName]\n    tickerName = tickerData[0].tickerName\n    let tickerPrice = [...tState.tickerPrice.toString()]\n    const response = await fetch(dbServer+'/api/getPrice?table=cmcCache&tickerId='+tickerId)\n    const body = await response.json()\n    if (response.status !== 200) {\n      throw Error(body.message)\n    } else {\n      tickerPrice = (body.Items[0].cmcCacheData.quote[currency].price)\n      setTState({ ...tState, tickerId, tickerPrice,tickerName, tickerSymbol })\n    }\n  }\n\n  /**\n  * Async function to enter trade data using the selected currency and input position data.\n  */\n  const enterTrade = async e => {\n    if (window.confirm (\"Are you sure?\")) {\n      let postData = []\n      postData.push({\"portfolioId\": pState.portfolioId})\n      postData.push({\"tradeDate\": new Date()})\n      postData.push({\"positionQty\":document.getElementById(\"positionQty\").value})\n      postData.push({\"tickerId\":tState.tickerId})\n      postData.push({\"tickerName\":tState.tickerName})\n      postData.push({\"tickerSymbol\":tState.tickerSymbol})\n      postData.push({\"tickerPrice\":tState.tickerPrice})\n\n      const response = await fetch(dbServer+'/api/postNewPosition', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ post: postData }),\n      })\n      const body = await response\n      if (response.status !== 200) {\n        throw Error(body.message)\n      } else {\n        refreshPortfolio()\n      }\n    }\n  }\n\n  /**\n  * Async function to reset the cache file in the database based on the button value.\n  */\n  const updateCacheFile = async e => {\n    //    const response = await fetch(dbServer+'/api/get?command=cmcCache&file='+e.target.textContent)\n    const response = await fetch(dbServer+'/api/getCMCCache?file='+e.target.textContent)\n    const body = await response.json()\n    if (response.status !== 200) {\n      throw Error(body.message)\n    } else {\n      loadTickers()\n      let tickers = []\n      setTState({...tState, tickers})\n      refreshPortfolio()\n    }\n  }\n\n  /**\n  * Async function to reset the portfolio view in the database completely.\n  */\n  const resetPortfolio = async e => {\n    if (window.confirm (\"Are you sure?\")) {\n      let postData = []\n      postData.push({\"portfolioId\": pState.portfolioId})\n      const response = await fetch(dbServer+'/api/resetPortfolio', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ post: postData }),\n      })\n      const body = await response\n      if (response.status !== 200) {\n        throw Error(body.message)\n      } else {\n        setTimeout(() => {\n          refreshPortfolio()\n        }, 250)\n      }\n    }\n  }\n\n  const getOptions = tState.tickers.map(\n    (ticker) => <option value={ticker.tickerId}>{ticker.tickerName}</option>\n  )\n\n  const getExchangeRates = erState.exchangeRates.map(\n    (exchangeRate) => <option value={exchangeRate.rateName}>{exchangeRate.rateName}</option>\n  )\n\n  const updateExchangeRate = (e) =>  {\n    let selectedExchangeRate = [...erState.selectedExchangeRate]\n    let exchangeRate = erState.exchangeRates.find(exchangeRateData => exchangeRateData.rateName == e.target.value)\n    selectedExchangeRate = []\n    selectedExchangeRate.push(exchangeRate)\n    setERState({ ...erState, selectedExchangeRate })\n  }\n\n  return (\n    <div>\n    {/* Headlines */}\n    <div className=\"outerDiv\">\n    <div className=\"leftDiv\"><h2>CryptoDash</h2></div>\n    <div className=\"midDiv\"><h4>Unrealised P&L Total: {erState.selectedExchangeRate[0].symbol+''+(pState.portfolioUnrealisedPL*erState.selectedExchangeRate[0].rate).toFixed(pState.precision)}</h4></div>\n    <div className=\"rightDiv\"><h4>Realised P&L Total: {erState.selectedExchangeRate[0].symbol+''+(pState.portfolioRealisedPL*erState.selectedExchangeRate[0].rate).toFixed(pState.precision)}</h4></div>\n    </div>\n\n    {/* Portfolio view table */}\n    <MaterialTable\n    title='Portfolio View'\n    icons={tableIcons}\n    columns={pState.portfoliocolumns}\n    data={pState.positionData}\n    editable={{\n      onRowDelete: oldData =>\n      new Promise(resolve => {\n        if(oldData.active === 'true') {\n          setTimeout(() => {\n            fetch(dbServer+'/api/getPrice?table=cmcCache&tickerId='+oldData.currencyId, { } )\n            .then(function(response) {\n              return response.json()\n            })\n            .then(function(currentPriceRes) {\n              let postData = []\n              postData.push({\"portfolioId\": oldData.portfolioId})\n              postData.push({\"table\": \"portfolios\"})\n              postData.push({\"positionId\": oldData.id})\n              postData.push({\"realisedPL\": (currentPriceRes.Items[0].cmcCacheData.quote.USD.price-oldData.tradePrice)*oldData.position})\n              fetch(dbServer+'/api/exitPosition', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Access-Control-Allow-Methods': '*',\n                  'Access-Control-Allow-Credentials': 'true',\n                  'Access-Control-Allow-Headers': 'Content-Type, Authorization'\n                },\n                body: JSON.stringify({ post: postData }),\n              }).then(function(response) {\n                refreshPortfolio()\n                resolve()\n              })\n            })\n          }, 250)\n        } else {\n          alert(\"You cannot exit a closed position.\")\n          resolve()\n        }\n      }),\n    }}\n    />\n\n    {/* Trade entry and system control */}\n    <table>\n    <tbody>\n    <tr><td><h3>Trade Entry</h3></td></tr>\n    <tr><td>Select currency</td><td><select onChange={getPrice}>{getOptions}</select></td></tr>\n    <tr><td>Price of currency</td><td id='tickerPrice'>{erState.selectedExchangeRate[0].symbol+''+(tState.tickerPrice*erState.selectedExchangeRate[0].rate) }</td></tr>\n    <tr><td>Position quantity</td><td><input id='positionQty' type='text' /></td></tr>\n    <tr><td></td><td><Button variant=\"contained\" color=\"primary\" onClick={enterTrade}>Trade</Button></td></tr>\n    <tr><td><h3>System Control</h3></td></tr>\n    <tr><td>Reload cache from sandbox</td><td><Button variant=\"contained\" color=\"primary\" onClick={updateCacheFile}>coinmarketcap.json</Button></td></tr>\n    <tr><td>Reload cache from pro</td><td><Button variant=\"contained\" color=\"primary\" onClick={updateCacheFile}>pro.coinmarketcap.json</Button></td></tr>\n    <tr><td>Reset portfolio</td><td><Button variant=\"contained\" color=\"primary\" onClick={resetPortfolio}>Zero positions</Button></td></tr>\n    <tr><td>Currency to view (USD={erState.selectedExchangeRate[0].rate})</td><td><select onChange={updateExchangeRate}>{getExchangeRates}</select></td></tr>\n    </tbody>\n    </table>\n\n    </div>\n  )\n}\n"],"sourceRoot":""}